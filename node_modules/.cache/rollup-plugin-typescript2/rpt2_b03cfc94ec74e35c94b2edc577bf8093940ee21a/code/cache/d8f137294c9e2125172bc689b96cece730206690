{"code":"export class ItemsMap {\r\n    constructor(state) {\r\n        this.state = state;\r\n        this.map = {};\r\n    }\r\n    generateGeometryIndexMap(modelID) {\r\n        if (this.map[modelID])\r\n            return;\r\n        const geometry = this.getGeometry(modelID);\r\n        const items = this.newItemsMap(modelID, geometry);\r\n        for (const group of geometry.groups) {\r\n            this.fillItemsWithGroupInfo(group, geometry, items);\r\n        }\r\n    }\r\n    getSubsetID(modelID, material, customID = 'DEFAULT') {\r\n        const baseID = modelID;\r\n        const materialID = material ? material.uuid : 'DEFAULT';\r\n        return `${baseID} - ${materialID} - ${customID}`;\r\n    }\r\n    dispose() {\r\n        Object.values(this.map).forEach(model => {\r\n            model.indexCache = null;\r\n            model.map = null;\r\n        });\r\n        this.map = null;\r\n    }\r\n    getGeometry(modelID) {\r\n        const geometry = this.state.models[modelID].mesh.geometry;\r\n        if (!geometry)\r\n            throw new Error('Model without geometry.');\r\n        if (!geometry.index)\r\n            throw new Error('Geometry must be indexed');\r\n        return geometry;\r\n    }\r\n    newItemsMap(modelID, geometry) {\r\n        const startIndices = geometry.index.array;\r\n        this.map[modelID] = {\r\n            indexCache: startIndices.slice(0, geometry.index.array.length),\r\n            map: new Map()\r\n        };\r\n        return this.map[modelID];\r\n    }\r\n    fillItemsWithGroupInfo(group, geometry, items) {\r\n        let prevExpressID = -1;\r\n        const materialIndex = group.materialIndex;\r\n        const materialStart = group.start;\r\n        const materialEnd = materialStart + group.count - 1;\r\n        let objectStart = -1;\r\n        let objectEnd = -1;\r\n        for (let i = materialStart; i <= materialEnd; i++) {\r\n            const index = geometry.index.array[i];\r\n            const bufferAttr = geometry.attributes.expressID;\r\n            const expressID = bufferAttr.array[index];\r\n            if (prevExpressID === -1) {\r\n                prevExpressID = expressID;\r\n                objectStart = i;\r\n            }\r\n            const isEndOfMaterial = i === materialEnd;\r\n            if (isEndOfMaterial) {\r\n                const store = this.getMaterialStore(items.map, expressID, materialIndex);\r\n                store.push(objectStart, materialEnd);\r\n                break;\r\n            }\r\n            if (prevExpressID === expressID)\r\n                continue;\r\n            const store = this.getMaterialStore(items.map, prevExpressID, materialIndex);\r\n            objectEnd = i - 1;\r\n            store.push(objectStart, objectEnd);\r\n            prevExpressID = expressID;\r\n            objectStart = i;\r\n        }\r\n    }\r\n    getMaterialStore(map, id, matIndex) {\r\n        if (map.get(id) === undefined) {\r\n            map.set(id, {});\r\n        }\r\n        const storedIfcItem = map.get(id);\r\n        if (storedIfcItem === undefined)\r\n            throw new Error('Geometry map generation error');\r\n        if (storedIfcItem[matIndex] === undefined) {\r\n            storedIfcItem[matIndex] = [];\r\n        }\r\n        return storedIfcItem[matIndex];\r\n    }\r\n}\r\n//# sourceMappingURL=ItemsMap.js.map","references":["/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/BaseDefinitions.ts","/Users/simquat/Development/web-ifc-three/node_modules/@types/three/index.d.ts"],"map":"{\"version\":3,\"file\":\"ItemsMap.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/IFC/components/subsets/ItemsMap.ts\"],\"names\":[],\"mappings\":\"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\"}"}
