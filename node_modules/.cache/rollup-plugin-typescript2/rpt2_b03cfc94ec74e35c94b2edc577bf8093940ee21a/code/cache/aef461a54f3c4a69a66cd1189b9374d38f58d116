{"code":"import { WorkerActions, WorkerAPIs } from '../BaseDefinitions';\r\nimport { DBOperation } from '../../indexedDB/IndexedDatabase';\r\nimport { IFCOPENINGELEMENT, IFCSPACE } from \"web-ifc\";\r\nexport class ParserHandler {\r\n    constructor(handler, serializer, BVH, IDB) {\r\n        this.handler = handler;\r\n        this.serializer = serializer;\r\n        this.BVH = BVH;\r\n        this.IDB = IDB;\r\n        this.optionalCategories = {\r\n            [IFCSPACE]: true,\r\n            [IFCOPENINGELEMENT]: false\r\n        };\r\n        this.API = WorkerAPIs.parser;\r\n    }\r\n    async setupOptionalCategories(config) {\r\n        this.optionalCategories = config;\r\n        return this.handler.request(this.API, WorkerActions.setupOptionalCategories, { config });\r\n    }\r\n    async parse(buffer, coordinationMatrix) {\r\n        this.handler.onprogressHandlers[this.handler.requestID] = (progress) => {\r\n            if (this.handler.state.onProgress)\r\n                this.handler.state.onProgress(progress);\r\n        };\r\n        this.handler.serializeHandlers[this.handler.requestID] = async (result) => {\r\n            this.updateState(result.modelID);\r\n            return this.getModel();\r\n        };\r\n        return this.handler.request(this.API, WorkerActions.parse, { buffer, coordinationMatrix });\r\n    }\r\n    getAndClearErrors(_modelId) {\r\n    }\r\n    updateState(modelID) {\r\n        this.handler.state.models[modelID] = {\r\n            modelID: modelID,\r\n            mesh: {},\r\n            types: {},\r\n            jsonData: {}\r\n        };\r\n    }\r\n    async getModel() {\r\n        const serializedModel = await this.IDB.load(DBOperation.transferIfcModel);\r\n        const model = this.serializer.reconstructIfcModel(serializedModel);\r\n        this.BVH.applyThreeMeshBVH(model.geometry);\r\n        this.handler.state.models[model.modelID].mesh = model;\r\n        return model;\r\n    }\r\n}\r\n//# sourceMappingURL=ParserHandler.js.map","references":["/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/IFCParser.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/BaseDefinitions.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/IFCWorkerHandler.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/IFCModel.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/serializer/Serializer.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/workers/ParserWorker.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/BvhManager.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/indexedDB/IndexedDatabase.ts","/Users/simquat/Development/web-ifc-three/node_modules/web-ifc/web-ifc-api-node.d.ts"],"map":"{\"version\":3,\"file\":\"ParserHandler.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/IFC/web-workers/handlers/ParserHandler.ts\"],\"names\":[],\"mappings\":\"AACA,OAAO,EAAE,aAAa,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAM/D,OAAO,EAAE,WAAW,EAAmB,MAAM,iCAAiC,CAAC;AAC/E,OAAO,EAAE,iBAAiB,EAAE,QAAQ,EAAE,MAAM,SAAS,CAAC;AAEtD,MAAM,OAAO,aAAa;IAStB,YAAoB,OAAyB,EACzB,UAAsB,EACtB,GAAe,EACf,GAAoB;QAHpB,YAAO,GAAP,OAAO,CAAkB;QACzB,eAAU,GAAV,UAAU,CAAY;QACtB,QAAG,GAAH,GAAG,CAAY;QACf,QAAG,GAAH,GAAG,CAAiB;QAVxC,uBAAkB,GAAuB;YACrC,CAAC,QAAQ,CAAC,EAAE,IAAI;YAChB,CAAC,iBAAiB,CAAC,EAAE,KAAK;SAC7B,CAAC;QAEF,QAAG,GAAG,UAAU,CAAC,MAAM,CAAC;IAMxB,CAAC;IAED,KAAK,CAAC,uBAAuB,CAAC,MAA0B;QACpD,IAAI,CAAC,kBAAkB,GAAG,MAAM,CAAC;QACjC,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,aAAa,CAAC,uBAAuB,EAAE,EAAC,MAAM,EAAC,CAAC,CAAC;IAC3F,CAAC;IAED,KAAK,CAAC,KAAK,CAAC,MAAW,EAAE,kBAA6B;QAClD,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,QAAwB,EAAE,EAAE;YACnF,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU;gBAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAC/E,CAAC,CAAC;QACF,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,KAAK,EAAE,MAAoB,EAAE,EAAE;YACpF,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAEjC,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC3B,CAAC,CAAC;QACF,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,aAAa,CAAC,KAAK,EAAE,EAAC,MAAM,EAAE,kBAAkB,EAAC,CAAC,CAAC;IAC7F,CAAC;IAED,iBAAiB,CAAC,QAAgB;IAClC,CAAC;IAEO,WAAW,CAAC,OAAe;QAC/B,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG;YACjC,OAAO,EAAE,OAAO;YAChB,IAAI,EAAE,EAAS;YACf,KAAK,EAAE,EAAE;YACT,QAAQ,EAAE,EAAE;SACf,CAAC;IACN,CAAC;IAOO,KAAK,CAAC,QAAQ;QAClB,MAAM,eAAe,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC;QACnE,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC3C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,GAAG,KAAK,CAAC;QACtD,OAAO,KAAK,CAAC;IACjB,CAAC;CACJ\"}"}
