{"code":"import { ErrorParserNotAvailable, ErrorRootStateNotAvailable, WorkerAPIs } from '../BaseDefinitions';\r\nimport { IFCParser } from '../../components/IFCParser';\r\nimport { DBOperation } from '../../indexedDB/IndexedDatabase';\r\nexport class ParserWorker {\r\n    constructor(worker, serializer, IDB) {\r\n        this.worker = worker;\r\n        this.serializer = serializer;\r\n        this.IDB = IDB;\r\n        this.API = WorkerAPIs.parser;\r\n    }\r\n    initializeParser() {\r\n        if (!this.parser) {\r\n            if (!this.worker.state)\r\n                throw new Error(ErrorRootStateNotAvailable);\r\n            this.parser = new IFCParser(this.worker.state);\r\n        }\r\n    }\r\n    setupOptionalCategories(data) {\r\n        this.initializeParser();\r\n        if (this.parser === undefined)\r\n            throw new Error(ErrorParserNotAvailable);\r\n        this.parser.setupOptionalCategories(data.args.config);\r\n        this.worker.post(data);\r\n    }\r\n    async parse(data) {\r\n        this.initializeParser();\r\n        if (this.parser === undefined)\r\n            throw new Error(ErrorParserNotAvailable);\r\n        if (this.worker.state)\r\n            this.worker.state.onProgress = (event) => this.onProgress(event, data);\r\n        const serializedIfcModel = await this.getResponse(data);\r\n        await this.IDB.save(serializedIfcModel, DBOperation.transferIfcModel);\r\n        this.worker.post(data);\r\n    }\r\n    onProgress(event, data) {\r\n        this.worker.post({ ...data, onProgress: true, result: event });\r\n    }\r\n    async getResponse(data) {\r\n        if (!this.parser)\r\n            throw new Error(ErrorParserNotAvailable);\r\n        const ifcModel = await this.parser.parse(data.args.buffer, data.args.coordinationMatrix);\r\n        const serializedIfcModel = this.serializer.serializeIfcModel(ifcModel);\r\n        this.cleanUpGeometries(ifcModel);\r\n        data.result = { modelID: ifcModel.modelID };\r\n        return serializedIfcModel;\r\n    }\r\n    cleanUpGeometries(model) {\r\n        model.geometry.dispose();\r\n        if (Array.isArray(model.material))\r\n            model.material.forEach(mat => mat.dispose());\r\n        else\r\n            model.material.dispose();\r\n    }\r\n}\r\n//# sourceMappingURL=ParserWorker.js.map","references":["/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/BaseDefinitions.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/IFCParser.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/serializer/Serializer.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/indexedDB/IndexedDatabase.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/IFCModel.ts"],"map":"{\"version\":3,\"file\":\"ParserWorker.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/IFC/web-workers/workers/ParserWorker.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EACH,uBAAuB,EACvB,0BAA0B,EAI1B,UAAU,EACb,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAE,SAAS,EAAkB,MAAM,4BAA4B,CAAC;AAEvE,OAAO,EAAE,WAAW,EAAmB,MAAM,iCAAiC,CAAC;AAO/E,MAAM,OAAO,YAAY;IAIrB,YAAoB,MAAoB,EACpB,UAAsB,EAEtB,GAAoB;QAHpB,WAAM,GAAN,MAAM,CAAc;QACpB,eAAU,GAAV,UAAU,CAAY;QAEtB,QAAG,GAAH,GAAG,CAAiB;QALxC,QAAG,GAAG,UAAU,CAAC,MAAM,CAAC;IAMxB,CAAC;IAED,gBAAgB;QACZ,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK;gBAAE,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;YACpE,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAClD;IACL,CAAC;IAED,uBAAuB,CAAC,IAAkB;QACtC,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAG,IAAI,CAAC,MAAM,KAAK,SAAS;YAAE,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;QACvE,IAAI,CAAC,MAAM,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,KAAK,CAAC,IAAkB;QAC1B,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAG,IAAI,CAAC,MAAM,KAAK,SAAS;YAAE,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;QACvE,IAAG,IAAI,CAAC,MAAM,CAAC,KAAK;YAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,CAAC,KAAqB,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;QAC7G,MAAM,kBAAkB,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACxD,MAAM,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,EAAE,WAAW,CAAC,gBAAgB,CAAC,CAAC;QACtE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAEO,UAAU,CAAC,KAAqB,EAAE,IAAkB;QACxD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,GAAG,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAC,CAAC,CAAC;IACjE,CAAC;IAEO,KAAK,CAAC,WAAW,CAAC,IAAkB;QACxC,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAC3D,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACzF,MAAM,kBAAkB,GAAG,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QACvE,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QACjC,IAAI,CAAC,MAAM,GAAG,EAAC,OAAO,EAAE,QAAQ,CAAC,OAAO,EAAC,CAAC;QAC1C,OAAO,kBAAkB,CAAC;IAC9B,CAAC;IAEO,iBAAiB,CAAC,KAAe;QACrC,KAAK,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACzB,IAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC;YAAE,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC;;YAC1E,KAAK,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IAClC,CAAC;CACJ\"}"}
