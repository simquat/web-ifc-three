{"code":"import { ErrorBadJson, ErrorBadJsonPath, ErrorRootStateNotAvailable, WorkerAPIs } from '../BaseDefinitions';\r\nimport { MemoryCleaner } from '../../components/MemoryCleaner';\r\nexport class StateWorker {\r\n    constructor(worker) {\r\n        this.worker = worker;\r\n        this.API = WorkerAPIs.workerState;\r\n    }\r\n    updateStateUseJson(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        this.worker.state.useJSON = data.args.useJson;\r\n        this.worker.post(data);\r\n    }\r\n    updateStateWebIfcSettings(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        this.worker.state.webIfcSettings = data.args.webIfcSettings;\r\n        this.worker.post(data);\r\n    }\r\n    updateModelStateJsonData(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        const model = this.getModel(data);\r\n        model.jsonData = data.args.jsonData;\r\n        this.worker.post(data);\r\n    }\r\n    updateModelStateTypes(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        const model = this.getModel(data);\r\n        model.types = data.args.types;\r\n        this.worker.post(data);\r\n    }\r\n    async dispose(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(\"Error: no state was found in the worker\");\r\n        if (!this.cleaner)\r\n            this.cleaner = new MemoryCleaner(this.worker.state);\r\n        await this.cleaner.dispose();\r\n        this.worker.post(data);\r\n    }\r\n    async loadJsonDataFromWorker(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        const currentModel = this.getModel(data);\r\n        const file = await fetch(data.args.path);\r\n        if (!file.ok)\r\n            throw new Error(ErrorBadJsonPath);\r\n        const json = await file.json();\r\n        if (typeof json !== 'object')\r\n            throw new Error(ErrorBadJson);\r\n        currentModel.jsonData = json;\r\n        this.worker.post(data);\r\n    }\r\n    getModel(data) {\r\n        if (!this.worker.state)\r\n            throw new Error(ErrorRootStateNotAvailable);\r\n        const modelID = data.args.modelID;\r\n        if (!this.worker.state.models[modelID]) {\r\n            this.worker.state.models[modelID] = { modelID, mesh: {}, types: {}, jsonData: {} };\r\n        }\r\n        return this.worker.state.models[modelID];\r\n    }\r\n}\r\n//# sourceMappingURL=StateWorker.js.map","references":["/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/web-workers/BaseDefinitions.ts","/Users/simquat/Development/web-ifc-three/web-ifc-three/src/IFC/components/MemoryCleaner.ts"],"map":"{\"version\":3,\"file\":\"StateWorker.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/IFC/web-workers/workers/StateWorker.ts\"],\"names\":[],\"mappings\":\"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\"}"}
