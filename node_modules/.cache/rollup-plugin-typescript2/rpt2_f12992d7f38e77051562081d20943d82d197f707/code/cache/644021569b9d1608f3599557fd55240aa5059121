{"code":"export var DBOperation;\r\n(function (DBOperation) {\r\n    DBOperation[DBOperation[\"transferIfcModel\"] = 0] = \"transferIfcModel\";\r\n    DBOperation[DBOperation[\"transferIndividualItems\"] = 1] = \"transferIndividualItems\";\r\n})(DBOperation || (DBOperation = {}));\r\nexport class IndexedDatabase {\r\n    async save(item, id) {\r\n        const open = IndexedDatabase.openOrCreateDB(id);\r\n        this.createSchema(open, id);\r\n        return new Promise((resolve, reject) => {\r\n            open.onsuccess = () => this.saveItem(item, open, id, resolve);\r\n        });\r\n    }\r\n    async load(id) {\r\n        const open = IndexedDatabase.openOrCreateDB(id);\r\n        return new Promise((resolve, reject) => {\r\n            open.onsuccess = () => this.loadItem(open, id, resolve);\r\n        });\r\n    }\r\n    createSchema(open, id) {\r\n        open.onupgradeneeded = function () {\r\n            const db = open.result;\r\n            db.createObjectStore(id.toString(), { keyPath: \"id\" });\r\n        };\r\n    }\r\n    saveItem(item, open, id, resolve) {\r\n        const { db, tx, store } = IndexedDatabase.getDBItems(open, id);\r\n        item.id = id;\r\n        store.put(item);\r\n        tx.oncomplete = () => IndexedDatabase.closeDB(db, tx, resolve);\r\n    }\r\n    loadItem(open, id, resolve) {\r\n        const { db, tx, store } = IndexedDatabase.getDBItems(open, id);\r\n        const item = store.get(id);\r\n        const callback = () => {\r\n            delete item.result.id;\r\n            resolve(item.result);\r\n        };\r\n        tx.oncomplete = () => IndexedDatabase.closeDB(db, tx, callback);\r\n    }\r\n    static getDBItems(open, id) {\r\n        const db = open.result;\r\n        const tx = db.transaction(id.toString(), \"readwrite\");\r\n        const store = tx.objectStore(id.toString());\r\n        return { db, tx, store };\r\n    }\r\n    static openOrCreateDB(id) {\r\n        return indexedDB.open(id.toString(), 1);\r\n    }\r\n    static closeDB(db, tx, resolve) {\r\n        db.close();\r\n        resolve(\"success\");\r\n    }\r\n}\r\n//# sourceMappingURL=IndexedDatabase.js.map","references":[],"map":"{\"version\":3,\"file\":\"IndexedDatabase.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/IFC/indexedDB/IndexedDatabase.ts\"],\"names\":[],\"mappings\":\"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\"}"}
